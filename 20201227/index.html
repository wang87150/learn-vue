<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VUe</title>
</head>

<body>
  <div id="app" class="main" style="color: red ; font-size: 12px ;" attr="nihao ">
    <h1>{{firstName}}</h1>
    <button @click="debounce">防抖</button>
    <button @click="throttle">节流</button>
  </div>
</body>
<!-- <script src="dist/umd/vue.js"></script> -->
<script src="node_modules/vue/dist/vue.js"></script>
<script>
  
  
  const vm = new Vue({
    el: '#app',
    components: {
      'my-button': {
        template: '<button>world</button>'
      }
    },
    data() {
      return {
        firstName: 'wang',
        lastName: 'zy',
        htmlStr: '',
        debounceObj: {
          a: '111',
          fn: null
        },
        throttleObj: {
          a: '111',
          fn: null
        }
      }
    },
    methods: {
      //防抖
      debounce() {
        this.debounceObj.fn.call(this.debounceObj, new Date(), 'n');
      },
      throttle() {
        this.throttleObj.fn.call(this.throttleObj, new Date(), 'n');
      },

      //创造防抖函数
      createDebounce(fn, delay) {
        let startTime = null;
        let endTime = null;
        let st = null;
        return function () {
          let context = this;
          let args = arguments;
          
          let cb = function () {
            startTime = null;
            fn.apply(context, args)
          }
          if (!startTime) {
            startTime = Date.now();
            st = setTimeout(cb, delay);
          } else {
            clearTimeout(st);
            endTime = Date.now();
            if (endTime - startTime < delay) {
              st = setTimeout(cb, delay);
            } else {
              cb();
            }
            startTime = endTime;
          }
        }
      },

      createThrottle(fn, delay) {
        let startTime = null;
        let endTime = null;
        return function() {
          let context = this;
          let args = arguments;
          let cb = function() {
            fn.apply(context, args);
          }
          if (!startTime) {
            startTime = Date.now();
            setTimeout(cb, delay);
          } else {
            endTime = Date.now();
            if (endTime - startTime >= delay) {
              startTime = endTime;
              setTimeout(cb, delay);
            } else {
            }
          }
        }
      }
    },
    computed: {
      fullName: {
        get: function () {
          console.log(1)
          return `${this.firstName}  ${this.lastName}`;
        },
        set: function (value) {
          console.log('value', value);
        }
      }

      // fullName() {
      //   console.log(1);
      //   return `${this.firstName}  ${this.lastName}`;
      // }
    },
    mounted() {
      let cb = function (a, b) {
        console.log("a", a);
        console.log("b", b);
        console.log("a", this.a);
      }
      let fn = this.createDebounce(cb, 3000);
      this.debounceObj.fn = fn;

      let fn1 = this.createThrottle(cb, 3000);
      this.throttleObj.fn = fn1;
    }
  })

  console.log(vm)
</script>

</html>